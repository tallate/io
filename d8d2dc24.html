<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png?v=5.1.3">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="项目总结," />










<meta name="description" content="¶前言 该项目是2017年参加学院组织的实训项目期间同小组成员开发的，是一个简化版的电商项目。 ¶涉及到的技术  掌握高并发站点的系统架构方法。 熟悉 linux 开发环境,掌握 tomcat、mysql 服务器集群的安装与配置。 理解 web 服务器的负载均衡原理,掌握配置方法。 掌握数据库主从复制,读写分离技术。 理解缓存原理,掌握缓存在程序开发的原理。 掌握 web 站点的动静分离技术。">
<meta name="keywords" content="项目总结">
<meta property="og:type" content="article">
<meta property="og:title" content="淘淘网络商城">
<meta property="og:url" content="https://tallate.github.io/d8d2dc24.html">
<meta property="og:site_name" content="Tallate">
<meta property="og:description" content="¶前言 该项目是2017年参加学院组织的实训项目期间同小组成员开发的，是一个简化版的电商项目。 ¶涉及到的技术  掌握高并发站点的系统架构方法。 熟悉 linux 开发环境,掌握 tomcat、mysql 服务器集群的安装与配置。 理解 web 服务器的负载均衡原理,掌握配置方法。 掌握数据库主从复制,读写分离技术。 理解缓存原理,掌握缓存在程序开发的原理。 掌握 web 站点的动静分离技术。">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://47.88.24.11/%E6%B7%98%E6%B7%98%E7%BD%91%E7%BB%9C%E5%95%86%E5%9F%8E/Search%E5%8A%9F%E8%83%BD%E6%B4%BB%E5%8A%A8%E5%9B%BE.png">
<meta property="og:image" content="http://47.88.24.11/%E6%B7%98%E6%B7%98%E7%BD%91%E7%BB%9C%E5%95%86%E5%9F%8E/%E6%B7%98%E6%B7%98%E5%95%86%E5%9F%8E%E6%A8%A1%E5%9D%97%E7%BB%93%E6%9E%84%E5%9B%BE.png">
<meta property="og:image" content="http://47.88.24.11/%E6%B7%98%E6%B7%98%E7%BD%91%E7%BB%9C%E5%95%86%E5%9F%8E/Search%E5%8A%9F%E8%83%BD%E6%97%B6%E5%BA%8F%E5%9B%BE.png">
<meta property="og:image" content="http://47.88.24.11/%E6%B7%98%E6%B7%98%E7%BD%91%E7%BB%9C%E5%95%86%E5%9F%8E/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8%E7%BB%93%E6%9E%84.png">
<meta property="og:image" content="http://47.88.24.11/%E6%B7%98%E6%B7%98%E7%BD%91%E7%BB%9C%E5%95%86%E5%9F%8E/%E6%90%9C%E7%B4%A2%E6%A1%86.png">
<meta property="og:image" content="http://47.88.24.11/%E6%B7%98%E6%B7%98%E7%BD%91%E7%BB%9C%E5%95%86%E5%9F%8E/%E5%95%86%E5%93%81%E6%90%9C%E7%B4%A2%E7%BB%93%E6%9E%9C.png">
<meta property="og:image" content="http://47.88.24.11/%E6%B7%98%E6%B7%98%E7%BD%91%E7%BB%9C%E5%95%86%E5%9F%8E/%E5%8E%8B%E5%8A%9B%E6%B5%8B%E8%AF%95%E7%BB%93%E6%9E%9C.png">
<meta property="og:updated_time" content="2018-10-11T12:38:51.930Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="淘淘网络商城">
<meta name="twitter:description" content="¶前言 该项目是2017年参加学院组织的实训项目期间同小组成员开发的，是一个简化版的电商项目。 ¶涉及到的技术  掌握高并发站点的系统架构方法。 熟悉 linux 开发环境,掌握 tomcat、mysql 服务器集群的安装与配置。 理解 web 服务器的负载均衡原理,掌握配置方法。 掌握数据库主从复制,读写分离技术。 理解缓存原理,掌握缓存在程序开发的原理。 掌握 web 站点的动静分离技术。">
<meta name="twitter:image" content="http://47.88.24.11/%E6%B7%98%E6%B7%98%E7%BD%91%E7%BB%9C%E5%95%86%E5%9F%8E/Search%E5%8A%9F%E8%83%BD%E6%B4%BB%E5%8A%A8%E5%9B%BE.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.3',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://tallate.github.io/d8d2dc24.html"/>







  <title>淘淘网络商城 | Tallate</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Tallate</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">不乱于心，不困于情，不畏将来，不念过往</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>

      <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://tallate.github.io/d8d2dc24.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="tallate">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tallate">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">淘淘网络商城</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-08-07T19:13:29+08:00">
                2018-08-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/2018-年中总结/" itemprop="url" rel="index">
                    <span itemprop="name">2018-年中总结</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-file-o"></i> 浏览
            <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>次
            </span>
          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  3.8k 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  14 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="前言"><a class="header-anchor" href="#前言">¶</a>前言</h2>
<p>该项目是2017年参加学院组织的实训项目期间同小组成员开发的，是一个简化版的电商项目。</p>
<h3 id="涉及到的技术"><a class="header-anchor" href="#涉及到的技术">¶</a>涉及到的技术</h3>
<ol>
<li>掌握高并发站点的系统架构方法。</li>
<li>熟悉 linux 开发环境,掌握 tomcat、mysql 服务器集群的安装与配置。</li>
<li>理解 web 服务器的负载均衡原理,掌握配置方法。</li>
<li>掌握数据库主从复制,读写分离技术。</li>
<li>理解缓存原理,掌握缓存在程序开发的原理。</li>
<li>掌握 web 站点的动静分离技术。</li>
</ol>
<a id="more"></a>
<h2 id="项目分析"><a class="header-anchor" href="#项目分析">¶</a>项目分析</h2>
<h3 id="基础知识总结"><a class="header-anchor" href="#基础知识总结">¶</a>基础知识总结</h3>
<ol>
<li>Java基础<br>
课程刚开始复习了许多Java基础知识，虽然开发主要依赖框架，但是磨刀不误砍柴工，只有熟练掌握基础知识，在使用框架中遇到问题时才能游刃有余。<br>
老师的讲解主要分两个阶段，首先讲解了属性文件、注解和反射等的使用方法，这些java功能是实现框架的基础，老师也一再强调通用性，而通用也正是框架存在的理由，因此老师第一步带领我们开发了一个简易的数据库访问框架，将常用的增删改查操作抽象出来，使得数据库访问操作的代码量大大减少，我们也得以对一些常见的数据库访问框架的工作原理有了一个较为深刻的理解，同时也为之后MyBatis框架的学习做了铺垫。<br>
然后讲解了数据读写方法、多线程操作、网络方面的知识，比较可贵的是老师并不是停留在基础用法上，而是做了很多有益的拓展，比如对数据读写，不仅讲了传统的Java IO方法，而且还讲了Java1.5引入的NIO（New IO）；在多线程方面，讲解了一些新的线程创建方法和解决死锁的方法，并且结合理论知识给出了解决生产者-消费者等经典问题的代码；网络编程方面，讲解了使用阻塞式和非阻塞式进行网络访问的方法，并且用这些知识实现了一个简易的聊天室程序。</li>
<li>MyBatis框架<br>
接下来老师为我们比较了Hibernate和MyBatis两种框架，并仔细介绍了MyBatis框架的使用方法，这个框架主要功能是访问数据库，访问数据库的关键是做好实体类和数据库表之间的映射，如果数据库到应用程序间的抽象做得越好、功能越通用，写出的代码鲁棒性也能越高。<br>
对于数据库映射，老师首先讲解了Mybatis的配置文件映射，其主要功能是将数据库操作代码和应用程序代码分开。我开始时非常不解，因为这样并没有简化反而使得程序更复杂了，但之后明白了，通过将主要业务逻辑和数据库操作代码分开，真正使得代码解耦、写活了。但我也发现这样的一个缺陷——因为这部分代码文件多了一倍导致程序也变得更加难以管理。所幸老师之后还介绍了注解映射，这种方式使得配置文件大大减少，实现了零配置。</li>
<li>Spring框架<br>
接下来老师介绍了Spring框架，Spring框架的核心是控制反转，它是通过将对接口的实例化过程转移到配置文件中来解决对实现类的依赖，达到把代码写活的目的。Spring并不只是一个实体类的工厂，由于集成了许多组件——比如SpringAOP、SpringMVC等，Spring可以很方便地应用于许多场景下。为了详细讲解Spring的概念，老师还不厌其烦地为我们讲解Spring的部分源码，达到了深入浅出的程度。</li>
<li>Maven包管理工具<br>
另外，不管是在老师演示还是自己操作时，我发现出现的最多的错误是包依赖产生的错误，因为程序中集成了不少的框架，于是在大到一定程度后，就会出现依赖特别难以管理的情况，为此老师提出了使用maven来管理依赖，解决了这个难题，因此我也感悟到工程实践的特点——它是一个不断简化的过程。更多关于实训项目相关的经历我会在下面进一步阐述。</li>
</ol>
<h3 id="项目介绍"><a class="header-anchor" href="#项目介绍">¶</a>项目介绍</h3>
<ol>
<li>项目介绍<br>
ebuy网上商城是一个综合性的B2C平台，类似京东商城、天猫商城。会员可以登录商城浏览商品、下订单，管理员可以登录后台对商品信息、商城内容进行管理。</li>
<li>个人职责<br>
本人在该项目开发当中的主要职责是搜索模块，包括网页端的AJAX访问逻辑、middle项目中对搜索结果添加缓存逻辑，及Solr搜索服务器的搭建。</li>
<li>相关技术<br>
(1) 项目开发方法<br>
该项目的开发应用了增量模型，在各个阶段并不交付一个可运行的完整产品，而是交付满足客户需求的一个子集的可运行产品。整个项目由多个子模块构成，由小组内不同成员负责开发，逐个构建地交付产品，并且最终使用版本管理工具整合进最终的产品中，这样的好处是软件开发可以较好地适应变化，客户可以不断地看到所开发的软件。</li>
<li>开发环境和工具<br>
Ubuntu 16.04<br>
IDEA、Maven 3.5.0、Tomcat 7.0.53、JDK 1.8、MySQL 5.6、Nginx 1.8.0、Redis 3.0.0、SVN</li>
<li>主要技术<br>
JSP、JSTL、jQuery、jQuery plugin、EasyUI、KindEditor<br>
Spring、SpringMVC、Solr、HttpClient、Nginx<br>
MyBatis、MySQL、Redis</li>
</ol>
<h3 id="系统分析"><a class="header-anchor" href="#系统分析">¶</a>系统分析</h3>
<ol>
<li>项目总体介绍<br>
Ebuy购物网站的主要目标是使用MVC框架实现一个B2C电商平台网站，实现的功能包括后台管理、前台、会员管理、订单管理、商品搜索、单点登录等。考虑到电商系统的普遍要求，如高并发、高可用等，使用到了动静分离、redis集群等技术。</li>
<li>Search子系统分析<br>
①　业务分析<br>
任意用户都可以在前台首页发起搜索请求，点击搜索按钮后会跳转到一个搜索结果显示页面，结果将以分页列表显示，在这个页面上用户也可以再次发起搜索。如果搜索字段为空，系统将以错误状态码响应。<br>
②　功能分析<br>
搜索子系统主要包含更新索引和搜索两个功能，如图2所示，用户参与Search模块的商品搜索用例，而商品搜索用例需要包含Solr模块搜索用例的执行，Create Index用例扩展了Intem Search用例，当有新的商品数据被添加到数据库时执行。<br>
<img src="http://47.88.24.11/%E6%B7%98%E6%B7%98%E7%BD%91%E7%BB%9C%E5%95%86%E5%9F%8E/Search%E5%8A%9F%E8%83%BD%E6%B4%BB%E5%8A%A8%E5%9B%BE.png" alt="X"><br>
图3是Search用例的活动图，表示用户进行搜索时的大致执行过程，用户可以在首页编辑发送搜索请求，此时前台会发送请求获取搜索结果，渲染页面并将结果显示给用户。</li>
</ol>
<h3 id="系统设计"><a class="header-anchor" href="#系统设计">¶</a>系统设计</h3>
<ol>
<li>总体设计<br>
Portal模块（门户），主要由静态的页面数据组成，网页中动态数据是由AJAX远程调用其他模块异步生成的；<br>
Manager模块（后台管理），主要负责对整个网站的商品的管理和网站内容的管理；<br>
Middle模块（数据中间件），主要目的是从数据库或者其他服务器获取数据，再使用JSON格式返回给Portal；<br>
Search模块（搜索），为商品建立索引，然后在每次调用搜索接口后将搜索结果包装为JSON字符串传回；<br>
Order模块（订单），主要使用Cookie来保存订单，当要下单时将购物车中的记录保存到数据库；<br>
SSO模块（单点登录模块），使用一个Redis集群保存登录token，实现单点登录。</li>
<li>详细设计<br>
①　功能模块设计<br>
搜索子系统主要功能模块为搜索和更新索引，其功能划分如图2所示，其中搜索功能需要首先在Solr服务器上给每个商品添加索引，然后在用户访问前台的搜索框时提供商品列表，更新索引功能可以在每次将商品添加到数据库中的同时在Solr服务器上更新该商品的索引，从而可以在后台添加商品后用户就能马上在前台找到对应的商品记录。<br>
②　类和对象设计<br>
以Search功能主要涉及的类为例，如图3所示，这个系统是按照MVC框架设计的，其中前台模块的ItemController负责接收请求，具体的搜索任务交给SearchService执行，SearchService调用了搜索模块的相应接口ItemSearchController的方法，搜索参数配置在ItemSearchService中进行，而具体的搜索功能由ItemSearchDao调用SolrServer的查询方法执行。<br>
<img src="http://47.88.24.11/%E6%B7%98%E6%B7%98%E7%BD%91%E7%BB%9C%E5%95%86%E5%9F%8E/%E6%B7%98%E6%B7%98%E5%95%86%E5%9F%8E%E6%A8%A1%E5%9D%97%E7%BB%93%E6%9E%84%E5%9B%BE.png" alt="X"><br>
③　动态模型设计<br>
Search子系统中搜索功能的时序图如图4所示，，首先用户在首页搜索框中输入搜索条件，点击搜索按钮，此时预设的AJAX程序会以搜索条件为参数调用前台的接口，前台模拟Http请求调用Search模块的搜索服务，进行格式化和分页处理，以及添加一些参数，调用Solr服务器的搜索服务获取结果，再由Portal渲染到页面中，完成一次搜索过程。<br>
<img src="http://47.88.24.11/%E6%B7%98%E6%B7%98%E7%BD%91%E7%BB%9C%E5%95%86%E5%9F%8E/Search%E5%8A%9F%E8%83%BD%E6%97%B6%E5%BA%8F%E5%9B%BE.png" alt="X"><br>
④　算法设计<br>
Search子系统的主要功能是搜索，以下是调用Solr搜索服务的算法实现： <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> SearchResult <span class="title">searchItem</span><span class="params">(SolrQuery solrQuery)</span> <span class="keyword">throws</span> SolrServerException </span>&#123;</span><br><span class="line">    <span class="comment">//根据查询条件搜索索引库</span></span><br><span class="line">    QueryResponse response = solrServer.query(solrQuery);</span><br><span class="line">    <span class="comment">//取商品列表</span></span><br><span class="line">    SolrDocumentList documentList = response.getResults();</span><br><span class="line">    <span class="comment">//商品列表</span></span><br><span class="line">    List&lt;Item&gt; itemList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (SolrDocument solrDocument : documentList) &#123;</span><br><span class="line">        Item item = <span class="keyword">new</span> Item();</span><br><span class="line">        item.setId(Long.parseLong((String) solrDocument.get(<span class="string">"id"</span>)));</span><br><span class="line">        <span class="comment">//取高亮显示</span></span><br><span class="line">        Map&lt;String, Map&lt;String, List&lt;String&gt;&gt;&gt; highlighting = response.getHighlighting();</span><br><span class="line">        List&lt;String&gt; list = highlighting.get(solrDocument.get(<span class="string">"id"</span>)).get(<span class="string">"item_title"</span>);</span><br><span class="line">        String title = <span class="string">""</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> != list &amp;&amp; !list.isEmpty()) &#123;</span><br><span class="line">            title = list.get(<span class="number">0</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            title = (String) solrDocument.get(<span class="string">"item_title"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        item.setTitle(title);</span><br><span class="line">        item.setPrice((Long) solrDocument.get(<span class="string">"item_price"</span>));</span><br><span class="line">        item.setSell_point((String) solrDocument.get(<span class="string">"item_sell_point"</span>));</span><br><span class="line">        item.setImage((String) solrDocument.get(<span class="string">"item_image"</span>));</span><br><span class="line">        item.setCategory_name((String) solrDocument.get(<span class="string">"item_category_name"</span>));</span><br><span class="line"></span><br><span class="line">        itemList.add(item);</span><br><span class="line">    &#125;</span><br><span class="line">    SearchResult result = <span class="keyword">new</span> SearchResult();</span><br><span class="line">    <span class="comment">//商品列表</span></span><br><span class="line">    result.setItemList(itemList);</span><br><span class="line">    <span class="comment">//总记录数据</span></span><br><span class="line">    result.setRecordCount(documentList.getNumFound());</span><br><span class="line">    System.out.println(result.getRecordCount());</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>⑤　数据库设计<br>
Search子系统主要使用到的表的ER图如图7所示。其中最重要的表是tb_item表，它的每条记录表示一个商品，search模块需要使用该表的id、item_title、item_sell_point等属性建立索引。<br>
<img src="http://47.88.24.11/%E6%B7%98%E6%B7%98%E7%BD%91%E7%BB%9C%E5%95%86%E5%9F%8E/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8%E7%BB%93%E6%9E%84.png" alt="X"></p>
<h3 id="系统实现"><a class="header-anchor" href="#系统实现">¶</a>系统实现</h3>
<ol>
<li>Search模块的运行过程<br>
①　首先由portal模块的ItemController接收到请求，将请求关键字转码并调用SearchService的方法 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">queryString = <span class="keyword">new</span> String(queryString.getBytes(<span class="string">"ISO8859-1"</span>), <span class="string">"UTF-8"</span>);</span><br><span class="line">SearchResult searchResult = searchService.searchItemList(queryString, page);</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>②　然后在portal模块的SearchService中构造参数列表并将请求发送给search模块处理<br>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//查询参数</span></span><br><span class="line">Map&lt;String, String&gt; param = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">param.put(<span class="string">"kw"</span>, queryString);</span><br><span class="line">param.put(<span class="string">"page"</span>, page==<span class="keyword">null</span>?<span class="string">"1"</span>:page.toString());</span><br><span class="line"><span class="comment">//调用search提供的搜索服务</span></span><br><span class="line">String resultString = MHttpClientUtil.mdoGet(SEARCH_BASE_URL, param);</span><br></pre></td></tr></table></figure></p>
<p>③　search模块的ItemSearchController同样先检验传递过来的参数是否有效，再调用ItemSearchService的服务<br>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (StringUtils.isBlank(queryString)) &#123;</span><br><span class="line">    <span class="keyword">return</span> MResult.build(<span class="number">400</span>, <span class="string">"查询条件是必须的参数"</span>);</span><br><span class="line">&#125;</span><br><span class="line">SearchResult result = itemSearchService.searchItem(queryString, page);</span><br></pre></td></tr></table></figure></p>
<p>④　在search模块的ItemSearchService中，需要为Solr查询构造查询对象，包括设置一些查询参数和分页设置等，最后调用ItemSearchDao的方法<br>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建一个查询对象</span></span><br><span class="line">SolrQuery solrQuery = <span class="keyword">new</span> SolrQuery();</span><br><span class="line"><span class="comment">//查询条件</span></span><br><span class="line"><span class="keyword">if</span>(StringUtils.isBlank(queryString)) &#123;</span><br><span class="line">    solrQuery.setQuery(<span class="string">"*:*"</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    solrQuery.setQuery(queryString);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//分页条件</span></span><br><span class="line"><span class="keyword">if</span> (page == <span class="keyword">null</span>) &#123;</span><br><span class="line">    page = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">solrQuery.setStart((page -<span class="number">1</span>) * PAGE_SIZE);</span><br><span class="line">solrQuery.setRows(PAGE_SIZE);</span><br><span class="line"><span class="comment">//高亮显示</span></span><br><span class="line">solrQuery.setHighlight(<span class="keyword">true</span>);</span><br><span class="line"><span class="comment">//设置高亮显示的域</span></span><br><span class="line">solrQuery.addHighlightField(<span class="string">"item_title"</span>);</span><br><span class="line"><span class="comment">//高亮显示前缀</span></span><br><span class="line">solrQuery.setHighlightSimplePre(<span class="string">"&lt;em style=\"color:red\"&gt;"</span>);</span><br><span class="line"><span class="comment">//后缀</span></span><br><span class="line">solrQuery.setHighlightSimplePost(<span class="string">"&lt;/em&gt;"</span>);</span><br><span class="line"><span class="comment">//设置默认搜索域</span></span><br><span class="line">solrQuery.set(<span class="string">"df"</span>, <span class="string">"item_keywords"</span>);</span><br><span class="line"><span class="comment">//执行查询</span></span><br><span class="line">SearchResult result = itemSearchDao.searchItem(solrQuery);</span><br></pre></td></tr></table></figure></p>
<p>⑤　ItemSearchDao封装了对Solr服务器的访问逻辑，主要过程是发送查询请求，获取Solr文档对象，从中解析出结果集合<br>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//根据查询条件搜索索引库</span></span><br><span class="line">QueryResponse response = solrServer.query(solrQuery);</span><br><span class="line"><span class="comment">//取商品列表</span></span><br><span class="line">SolrDocumentList documentList = response.getResults();</span><br><span class="line"><span class="comment">//商品列表</span></span><br><span class="line">List&lt;Item&gt; itemList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"><span class="keyword">for</span> (SolrDocument solrDocument : documentList) &#123;</span><br><span class="line">    Item item = <span class="keyword">new</span> Item();</span><br><span class="line">    item.setId(Long.parseLong((String) solrDocument.get(<span class="string">"id"</span>)));</span><br><span class="line">    <span class="comment">//取高亮显示</span></span><br><span class="line">    Map&lt;String, Map&lt;String, List&lt;String&gt;&gt;&gt; highlighting = response.getHighlighting();</span><br><span class="line">    List&lt;String&gt; list = highlighting.get(solrDocument.get(<span class="string">"id"</span>)).get(<span class="string">"item_title"</span>);</span><br><span class="line">    String title = <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">null</span> != list &amp;&amp; !list.isEmpty()) &#123;</span><br><span class="line">        title = list.get(<span class="number">0</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        title = (String) solrDocument.get(<span class="string">"item_title"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    item.setTitle(title);</span><br><span class="line">    item.setPrice((Long) solrDocument.get(<span class="string">"item_price"</span>));</span><br><span class="line">    item.setSell_point((String) solrDocument.get(<span class="string">"item_sell_point"</span>));</span><br><span class="line">    item.setImage((String) solrDocument.get(<span class="string">"item_image"</span>));</span><br><span class="line">    item.setCategory_name((String) solrDocument.get(<span class="string">"item_category_name"</span>));</span><br><span class="line"></span><br><span class="line">    itemList.add(item);</span><br><span class="line">&#125;</span><br><span class="line">SearchResult result = <span class="keyword">new</span> SearchResult();</span><br><span class="line"><span class="comment">//商品列表</span></span><br><span class="line">result.setItemList(itemList);</span><br><span class="line"><span class="comment">//总记录数据</span></span><br><span class="line">result.setRecordCount(documentList.getNumFound());</span><br><span class="line">System.out.println(result.getRecordCount());</span><br><span class="line"><span class="keyword">return</span> result;</span><br></pre></td></tr></table></figure></p>
<p>⑥　返回，按上面的顺序，将结果返回到portal模块的控制器ItemController中去<br>
⑦　最后portal模块的ItemController将结果渲染到相应的页面中去<br>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">model.addAttribute(<span class="string">"itemList"</span>, searchResult.getItemList());</span><br><span class="line">model.addAttribute(<span class="string">"query"</span>, queryString);</span><br><span class="line">model.addAttribute(<span class="string">"totalPages"</span>, searchResult.getPageCount());</span><br><span class="line">model.addAttribute(<span class="string">"page"</span>, searchResult.getCurPage());</span><br><span class="line">model.addAttribute(<span class="string">"pages"</span>, searchResult.getPageCount());</span><br><span class="line"><span class="keyword">return</span> <span class="string">"search"</span>;</span><br></pre></td></tr></table></figure></p>
<ol>
<li>初步成果<br>
首页搜索框<br>
<img src="http://47.88.24.11/%E6%B7%98%E6%B7%98%E7%BD%91%E7%BB%9C%E5%95%86%E5%9F%8E/%E6%90%9C%E7%B4%A2%E6%A1%86.png" alt="X"><br>
<img src="http://47.88.24.11/%E6%B7%98%E6%B7%98%E7%BD%91%E7%BB%9C%E5%95%86%E5%9F%8E/%E5%95%86%E5%93%81%E6%90%9C%E7%B4%A2%E7%BB%93%E6%9E%9C.png" alt="X"></li>
</ol>
<h3 id="系统测试"><a class="header-anchor" href="#系统测试">¶</a>系统测试</h3>
<ol>
<li>测试方案设计<br>
对该搜索子系统的测试主要集中在功能测试和压力测试两方面，即确保正常情况下内容的正确显示及高并发下的可用性。</li>
<li>测试用例设计<br>
①　使用英文和中文进行搜索，判断搜索结果是否正确<br>
②　使用100个线程分别对该搜索功能进行访问，判断网站是否出现崩溃的现象。</li>
<li>测试结果及评价<br>
<img src="http://47.88.24.11/%E6%B7%98%E6%B7%98%E7%BD%91%E7%BB%9C%E5%95%86%E5%9F%8E/%E5%8E%8B%E5%8A%9B%E6%B5%8B%E8%AF%95%E7%BB%93%E6%9E%9C.png" alt="X"><br>
Search子模块能够有效显示结果，并且如图在1000个线程并发访问的情况下能正常工作。</li>
</ol>
<h2 id="体会"><a class="header-anchor" href="#体会">¶</a>体会</h2>
<p>通过这次实训，我收获了很多，一方面学习到了许多以前没学过的专业知识与应用，另一方面还提高了自己动手做项目的能力。本次实训，是对我能力的进一步锻炼，也是一种考验。从中获得的诸多收获，也是很可贵的，是非常有意义的。<br>
在实训中我学到了许多新的知识。是一个让我把书本上的理论知识运用于实践中的好机会，原来，学的时候感叹学的内容太难懂，现在想来，有些其实并不难，关键在于理解，而且如果能够在实践中把握知识，情况就会好很多。<br>
在这次实训中还锻炼了我许多其他方面的能力，提高了我的综合素质。首先，它锻炼了我与小组成员交流的能力，通过沟通我们才能够很好地分工，努力地为了目标而各尽其力；同时也锻炼了自己吃苦耐劳的精神，因为某些任务具有一定的难度，甚至需要加班加点完成，如果轻言放弃就没有现在最终的成果。</p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/项目总结/" rel="tag"># 项目总结</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/b48184e9.html" rel="next" title="DataStructure-集合">
                <i class="fa fa-chevron-left"></i> DataStructure-集合
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/6ca318ec.html" rel="prev" title="记一次硬盘数据的迁移">
                记一次硬盘数据的迁移 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div id="gitalk-container"></div>

  

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">tallate</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">57</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">11</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">12</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          <div class="links-of-author motion-element">
            
          </div>

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#前言"><span class="nav-number">1.</span> <span class="nav-text">¶前言</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#涉及到的技术"><span class="nav-number">1.1.</span> <span class="nav-text">¶涉及到的技术</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#项目分析"><span class="nav-number">2.</span> <span class="nav-text">¶项目分析</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#基础知识总结"><span class="nav-number">2.1.</span> <span class="nav-text">¶基础知识总结</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#项目介绍"><span class="nav-number">2.2.</span> <span class="nav-text">¶项目介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#系统分析"><span class="nav-number">2.3.</span> <span class="nav-text">¶系统分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#系统设计"><span class="nav-number">2.4.</span> <span class="nav-text">¶系统设计</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#系统实现"><span class="nav-number">2.5.</span> <span class="nav-text">¶系统实现</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#系统测试"><span class="nav-number">2.6.</span> <span class="nav-text">¶系统测试</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#体会"><span class="nav-number">3.</span> <span class="nav-text">¶体会</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        

<div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">tallate</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.3</div>








        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i> 访问人数
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i> 访问总量
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      次
    </span>
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.3"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.3"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.3"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  


  




	





  





  












  <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
  <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
   <script type="text/javascript">
        var gitalk = new Gitalk({
          clientID: '72bdd1c9479eb0679788',
          clientSecret: '62c9c0cb45aadb1478ca66cfc3c69c9623f50290',
          repo: 'tallate.github.io',
          owner: 'tallate',
          admin: ['tallate'],
          id: location.pathname,
          distractionFreeMode: 'true'
        })
        gitalk.render('gitalk-container')           
       </script>



  





  

  

  
  

  

  

  


<script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({"modle":"wanko","pluginModelPath":"assets/","mobile":{"show":false},"display":{"position":"left","width":150,"height":300},"log":false,"pluginJsPath":"lib/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
