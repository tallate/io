<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png?v=5.1.3">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="Docker,">










<meta name="description" content="相当于给官网上的get-started翻译了一下。">
<meta name="keywords" content="Docker">
<meta property="og:type" content="article">
<meta property="og:title" content="Docker官方入门文档">
<meta property="og:url" content="https://tallate.github.io/94ee6da6.html">
<meta property="og:site_name" content="Tallate">
<meta property="og:description" content="相当于给官网上的get-started翻译了一下。">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2021-01-13T01:26:05.901Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Docker官方入门文档">
<meta name="twitter:description" content="相当于给官网上的get-started翻译了一下。">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.3',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://tallate.github.io/94ee6da6.html">







  <title>Docker官方入门文档 | Tallate</title>
  








</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Tallate</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">不乱于心，不困于情，不畏将来，不念过往</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>

      <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://tallate.github.io/94ee6da6.html">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="tallate">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tallate">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Docker官方入门文档</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-09-07T18:51:58+08:00">
                2019-09-07
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Docker/" itemprop="url" rel="index">
                    <span itemprop="name">Docker</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-file-o"></i> 浏览
            <span class="busuanzi-value" id="busuanzi_value_page_pv"></span>次
            </span>
          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  2.9k 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  15 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>相当于给官网上的get-started翻译了一下。</p>
<a id="more"></a>
<h1>Container</h1>
<h2 id="dockerfile"><a class="header-anchor" href="#dockerfile">¶</a>Dockerfile</h2>
<blockquote>
<p>Dockerfile defines what goes on in the environment inside your container. Access to resources like networking interfaces and disk drives is virtualized inside this environment, which is isolated from the rest of your system, so you need to map ports to the outside world, and be specific about what files you want to “copy in” to that environment.</p>
</blockquote>
<h3 id="示例"><a class="header-anchor" href="#示例">¶</a>示例</h3>
<ul>
<li>Dockerfile</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># Use an official Python runtime as a parent image</span><br><span class="line">FROM python:2.7-slim</span><br><span class="line"># Set the working directory to /app</span><br><span class="line">WORKDIR /app</span><br><span class="line"># Copy the current directory contents into the container at /app</span><br><span class="line">ADD . /app</span><br><span class="line"># Install any needed packages specified in requirements.txt</span><br><span class="line">RUN pip install --trusted-host pypi.python.org -r requirements.txt</span><br><span class="line"># Make port 80 available to the world outside this container</span><br><span class="line">EXPOSE 80</span><br><span class="line"># Define environment variable</span><br><span class="line">ENV NAME World</span><br><span class="line"># Run app.py when the container launches</span><br><span class="line">CMD [&quot;python&quot;, &quot;app.py&quot;]</span><br></pre></td></tr></table></figure>
<ul>
<li>requirements.txt文件<br>
连同下面的app.py需要和Dockerfile放在同级目录下</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Flask</span><br><span class="line">Redis</span><br></pre></td></tr></table></figure>
<ul>
<li><a href="http://app.py" target="_blank" rel="noopener">app.py</a><br>
打印host名，在Docker内部就是container ID</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">from flask import Flask</span><br><span class="line">from redis import Redis, RedisError</span><br><span class="line">import os</span><br><span class="line">import socket</span><br><span class="line"># Connect to Redis</span><br><span class="line">redis = Redis(host=&quot;redis&quot;, db=0, socket_connect_timeout=2, socket_timeout=2)</span><br><span class="line">app = Flask(__name__)</span><br><span class="line">@app.route(&quot;/&quot;)</span><br><span class="line">def hello():</span><br><span class="line">    try:</span><br><span class="line">        visits = redis.incr(&quot;counter&quot;)</span><br><span class="line">    except RedisError:</span><br><span class="line">        visits = &quot;&lt;i&gt;cannot connect to Redis, counter disabled&lt;/i&gt;&quot;</span><br><span class="line">    html = &quot;&lt;h3&gt;Hello &#123;name&#125;!&lt;/h3&gt;&quot; \</span><br><span class="line">           &quot;&lt;b&gt;Hostname:&lt;/b&gt; &#123;hostname&#125;&lt;br/&gt;&quot; \</span><br><span class="line">           &quot;&lt;b&gt;Visits:&lt;/b&gt; &#123;visits&#125;&quot;</span><br><span class="line">    return html.format(name=os.getenv(&quot;NAME&quot;, &quot;world&quot;), hostname=socket.gethostname(), visits=visits)</span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    app.run(host=&apos;0.0.0.0&apos;, port=80)</span><br></pre></td></tr></table></figure>
<ul>
<li>执行</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 构建image，并为image取别名</span><br><span class="line">docker build -t friendlyhello .</span><br><span class="line">docker image ls</span><br><span class="line"># 执行，并将内部（容器）的80端口映射到外部（主机）的4000端口</span><br><span class="line">docker run -p 4000:80 friendlyhello</span><br><span class="line"># 在后台执行</span><br><span class="line">docker run -d -p 4000:80 friendlyhello</span><br><span class="line"># -t相当于在终端登录到容器，-i可以将终端的STDIN通过管道（？man手册没有提到这个）连到容器的STDIN，以实现与容器内部的交互</span><br><span class="line">docker run -it -p 80:80 friendlyhello</span><br></pre></td></tr></table></figure>
<ul>
<li>终止<br>
linux下直接CTRL+C即可，但在Windows下需要再关闭容器：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker container ls</span><br><span class="line">docker container stop &lt;Container NAME or ID&gt;</span><br></pre></td></tr></table></figure>
<h3 id="设置代理服务器"><a class="header-anchor" href="#设置代理服务器">¶</a>设置代理服务器</h3>
<p>否则可能Docker会不能访问外网，导致上边的安装命令失败，所以在上边的安装命令之前：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># Set proxy server, replace host:port with values for your servers</span><br><span class="line">ENV http_proxy host:port</span><br><span class="line">ENV https_proxy host:port</span><br></pre></td></tr></table></figure>
<h3 id="发布dockerfile"><a class="header-anchor" href="#发布dockerfile">¶</a>发布Dockerfile</h3>
<ol>
<li>
<p>注册账号：<br>
<a href="https://cloud.docker.com/" target="_blank" rel="noopener">https://cloud.docker.com/</a></p>
</li>
<li>
<p>然后登录</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker login</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>将本地image与仓库关联</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># tag相当于版本号，或者其他的有意义的信息</span><br><span class="line"># docker tag image username/repository:tag</span><br><span class="line">docker tag friendlyhello tallate/get-started:version1</span><br><span class="line"># 上传至Docker Hub</span><br><span class="line">docker push tallate/get-started:version1</span><br><span class="line"># 在任何环境下运行，会自动拉取requirements.txt中定义的依赖项</span><br><span class="line">docker run -p 4000:80 tallate/get-started:version1</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>在Docker Hub中查看<br>
<a href="https://cloud.docker.com/swarm/tallate/repository/list" target="_blank" rel="noopener">https://cloud.docker.com/swarm/tallate/repository/list</a></p>
</li>
</ol>
<h1>Service(Compose)</h1>
<h2 id="service"><a class="header-anchor" href="#service">¶</a>Service</h2>
<p>Services are really just “containers in production.” A service only runs one image, but it codifies the way that image runs—what ports it should use, how many replicas of the container should run so the service has the capacity it needs, and so on. Scaling a service changes the number of container instances running that piece of software, assigning more computing resources to the service in the process.<br>
is a cluster of machines running Docker, and deployed an application to it, with containers running in concert on multiple machines.</p>
<h3 id="使用docker-compose编排服务"><a class="header-anchor" href="#使用docker-compose编排服务">¶</a>使用Docker Compose编排服务</h3>
<ul>
<li>定义docker-compose.yml文件：<br>
该服务包含5个对应image的容器实例</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">version: &quot;3&quot;</span><br><span class="line">services:</span><br><span class="line">  web:</span><br><span class="line">    # replace username/repo:tag with your name and image details</span><br><span class="line">    image: tallate/get-started:version1</span><br><span class="line">    deploy:</span><br><span class="line">      replicas: 5</span><br><span class="line">      resources:</span><br><span class="line">        limits:</span><br><span class="line">          cpus: &quot;0.1&quot;</span><br><span class="line">          memory: 50M</span><br><span class="line">      restart_policy:</span><br><span class="line">        condition: on-failure</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;80:80&quot;</span><br><span class="line">    networks:</span><br><span class="line">      - webnet</span><br><span class="line">networks:</span><br><span class="line">  webnet:</span><br></pre></td></tr></table></figure>
<p>Pull the image uploaded from the registry.<br>
Run 5 instances of that image as a service called web, limiting each one to use, at most, 10% of the CPU (across all cores), and 50MB of RAM.<br>
Immediately restart containers if one fails.<br>
Map port 80 on the host to web’s port 80.<br>
Instruct web’s containers to share port 80 via a load-balanced network called webnet. (Internally, the containers themselves publish to web’s port 80 at an ephemeral port.)<br>
Define the webnet network with the default settings (which is a load-balanced overlay network).</p>
<ul>
<li>使用Swarm管理集群</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 如果有双网卡的情况需要指定ip（每个网卡一个ip）</span><br><span class="line">docker swarm init --advertise-addr 192.168.1.105</span><br></pre></td></tr></table></figure>
<ul>
<li>运行，并为app命名</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker stack deploy -c docker-compose.yml getstartedlab</span><br></pre></td></tr></table></figure>
<ul>
<li>查看服务</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker service ls</span><br></pre></td></tr></table></figure>
<p>web服务会在后面带上一个&quot;_web&quot;后缀</p>
<h3 id="task"><a class="header-anchor" href="#task">¶</a>Task</h3>
<ul>
<li>A single container running in a service is called a task. Tasks are given unique IDs that numerically increment, up to the number of replicas you defined in docker-compose.yml.</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># List the tasks for your service</span><br><span class="line">docker service ps getstartedlab_web</span><br><span class="line"># 或者直接列出所有容器，-q表示quiet只列出ID</span><br><span class="line">docker container ls -q</span><br></pre></td></tr></table></figure>
<ul>
<li>访问服务<br>
服务已经具有了负载均衡的特性，with each request, one of the 5 tasks is chosen, in a round-robin fashion, to respond.</li>
<li>可能出现响应过慢的情况<br>
暂时还没有加入redis服务，所以访问redis时会直到超时一直在等待，导致请求响应过慢的情况</li>
</ul>
<blockquote>
<p>Depending on your environment’s networking configuration, it may take up to 30 seconds for the containers to respond to HTTP requests. This is not indicative of Docker or swarm performance, but rather an unmet Redis dependency that we address later in the tutorial. For now, the visitor counter isn’t working for the same reason; we haven’t yet added a service to persist data.<br>
估计是和docker-compose.yml中的属性（内存、cpu等）、本机的网络配置有关系。</p>
</blockquote>
<ul>
<li>终止应用</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 终止应用</span><br><span class="line">docker stack rm getstartedlab</span><br><span class="line"># 终止swarm</span><br><span class="line">docker swarm leave --force</span><br></pre></td></tr></table></figure>
<h3 id="scale"><a class="header-anchor" href="#scale">¶</a>scale</h3>
<p>可以修改docker-compose.yml中的replicas属性来伸缩应用，只需要再运行一次部署，Docker performs an in-place update, no need to tear the stack down first or kill any containers：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker stack deploy -c docker-compose.yml getstartedlab</span><br></pre></td></tr></table></figure>
<h1>Swarm(Cluster)</h1>
<h2 id="安装docker-machine"><a class="header-anchor" href="#安装docker-machine">¶</a>安装docker-machine</h2>
<p>下载：<a href="https://github.com/docker/machine/releases" target="_blank" rel="noopener">https://github.com/docker/machine/releases</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 拷贝到可执行目录</span><br><span class="line">sudo cp docker-machine-Linux-x86_64 /usr/local/bin/docker-machine</span><br><span class="line"># 赋权限</span><br><span class="line">sudo chmod +x /usr/local/bin/docker-machine</span><br></pre></td></tr></table></figure>
<h2 id="swarm"><a class="header-anchor" href="#swarm">¶</a>Swarm</h2>
<h3 id="manager和worker"><a class="header-anchor" href="#manager和worker">¶</a>manager和worker</h3>
<p>A swarm is a group of machines that are running Docker and joined into a cluster.<br>
只有manager会执行指令，其他workers只用于扩容。<br>
you continue to run the Docker commands you’re used to, but now they are executed on a cluster by a swarm <strong>manager</strong>. The machines in a swarm can be physical or virtual. After joining a swarm, they are referred to as <strong>nodes</strong>.<br>
Swarm managers are the only machines in a swarm that can execute your commands, or authorize other machines to join the swarm as workers. Workers are just there to provide capacity and do not have the authority to tell any other machine what it can and cannot do.</p>
<h3 id="多种运行容器策略"><a class="header-anchor" href="#多种运行容器策略">¶</a>多种运行容器策略</h3>
<p>Swarm managers can use several strategies to run containers, such as “<strong>emptiest node</strong>” – which fills the least utilized machines with containers. Or “<strong>global</strong>”, which ensures that each machine gets exactly one instance of the specified container. You instruct the swarm manager to use these strategies in the Compose file, just like the one you have already been using.</p>
<h3 id="初始化虚拟机"><a class="header-anchor" href="#初始化虚拟机">¶</a>初始化虚拟机</h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># enable swarm mode and make your current machine a swarm manager</span><br><span class="line">docker swarm init</span><br><span class="line"># on other machines to have them join the swarm as workers</span><br><span class="line">docker swarm join</span><br></pre></td></tr></table></figure>
<h3 id="在虚拟机中执行"><a class="header-anchor" href="#在虚拟机中执行">¶</a>在虚拟机中执行</h3>
<p>先安装virtualbox，然后：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker-machine create --driver virtualbox myvm1</span><br><span class="line">docker-machine create --driver virtualbox myvm2</span><br><span class="line"># 查看虚拟机属性</span><br><span class="line">docker-machine ls</span><br></pre></td></tr></table></figure>
<h3 id="初始化swarm集群"><a class="header-anchor" href="#初始化swarm集群">¶</a>初始化Swarm集群</h3>
<p>The first machine acts as the manager, which executes management commands and authenticates workers to join the swarm, and the second is a worker.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># 初始化manager，注意这里的ip是虚拟机内的ip，命令成功后会返回一条命令提示worker加入集群的方式</span><br><span class="line">docker-machine ssh myvm1 &quot;docker swarm init --advertise-addr &lt;myvm1 ip&gt;&quot;</span><br><span class="line"># 如果内置的ssh出错，可以使用本机的ssh</span><br><span class="line"># docker-machine --native-ssh ssh myvm1 ...</span><br><span class="line"># 将其他节点加入集群</span><br><span class="line">docker-machine ssh myvm2 &quot;docker swarm join --token SWMTKN-1-1aac1t43c8g98xf2b88xqdxwuz7c740vizr7rld19k0d6xff6j-7i05pruv9w16anm0z96eeysvj 192.168.99.100:2377&quot;</span><br><span class="line"># 在manager中查看集群中的所有nodes</span><br><span class="line">docker-machine ssh myvm1 &quot;docker node ls&quot;</span><br><span class="line"># 拷贝文件</span><br><span class="line">docker-machine scp &lt;file&gt; &lt;machine&gt;:~</span><br><span class="line"># 关闭集群</span><br><span class="line">docker swarm leave</span><br></pre></td></tr></table></figure>
<ul>
<li>端口号<br>
Always run docker swarm init and docker swarm join with port 2377 (the swarm management port), or no port at all and let it take the default.<br>
The machine IP addresses returned by docker-machine ls include port 2376, which is the Docker daemon port. Do not use this port or you <a href="https://forums.docker.com/t/docker-swarm-join-with-virtualbox-connection-error-13-bad-certificate/31392/2" target="_blank" rel="noopener">may experience errors</a>.</li>
</ul>
<h3 id="在集群中部署app"><a class="header-anchor" href="#在集群中部署app">¶</a>在集群中部署app</h3>
<ul>
<li>远程访问配置<br>
Another option is to run <code>docker-machine env &lt;machine&gt;</code> to get and run a command that configures your current shell to talk to the Docker daemon on the VM. This method works better for the next step because it allows you to use your local <code>docker-compose.yml</code> file to deploy the app “remotely” without having to copy it anywhere.</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># get the command to configure your shell to talk to myvm1</span><br><span class="line">docker-machine env myvm1</span><br><span class="line"># configure your shell to talk to myvm1</span><br><span class="line">eval $(docker-machine env myvm1)</span><br><span class="line"># 如果ACTIVE带星号说明是active machine，docker client靠着上面配置的环境变量来决定和docker daemon交互的行为</span><br><span class="line">docker-machine ls</span><br></pre></td></tr></table></figure>
<ul>
<li>在虚拟机中部署应用<br>
只需要在manager中部署应用，不需要在worker中部署：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 需要先运行上边的eval命令，再部署</span><br><span class="line">docker stack deploy -c docker-compose.yml getstartedlab</span><br><span class="line"># 查看节点上的服务</span><br><span class="line">docker service ls</span><br><span class="line">docker service ps &lt;service_name&gt;</span><br></pre></td></tr></table></figure>
<h3 id="集群路由原理"><a class="header-anchor" href="#集群路由原理">¶</a>集群路由原理</h3>
<p>The reason both IP addresses work is that nodes in a swarm participate in an ingress <strong>routing mesh</strong>. This ensures that a service deployed at a certain port within your swarm always has that port reserved to itself, no matter what node is actually running the container. Here’s a diagram of how a routing mesh for a service called <code>my-web</code> published at port <code>8080</code> on a three-node swarm would look:<br>
routing mesh diagram<br>
Keep in mind that to use the ingress network in the swarm, you need to have the following ports open between the swarm nodes before you enable swarm mode:</p>
<ul>
<li>Port 7946 TCP/UDP for container <strong>network discovery</strong>.</li>
<li>Port 4789 UDP for the container <strong>ingress network</strong>.</li>
</ul>
<h3 id="终止"><a class="header-anchor" href="#终止">¶</a>终止</h3>
<ol>
<li>
<p>tear down the stack</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker stack rm getstartedlab</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>移除swarm</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># worker</span><br><span class="line">docker-machine ssh myvm2 &quot;docker swarm leave&quot;</span><br><span class="line"># manager</span><br><span class="line">docker-machine ssh myvm1 &quot;docker swarm leave --force&quot;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="移除docker-machine-shell-variable环境变量设置"><a class="header-anchor" href="#移除docker-machine-shell-variable环境变量设置">¶</a>移除docker-machine shell variable环境变量设置</h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eval $(docker-machine env -u)</span><br></pre></td></tr></table></figure>
<h3 id="重启"><a class="header-anchor" href="#重启">¶</a>重启</h3>
<p>因为是在本地虚拟机中搭建的集群，在合上电脑后虚拟机就关闭了、服务也就终止了，需要重启：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 查看虚拟机状态</span><br><span class="line">docker-machine ls</span><br><span class="line"># 重启</span><br><span class="line">docker-machine start &lt;machine-name&gt;</span><br></pre></td></tr></table></figure>
<p>如果是manager节点挂掉了，重启后会发现其他节点的状态是Down：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 查看所有节点状态</span><br><span class="line">docker node ls</span><br></pre></td></tr></table></figure>
<h1>Stack(Complex Cluster)</h1>
<h2 id="stack"><a class="header-anchor" href="#stack">¶</a>Stack</h2>
<p>A stack is a group of interrelated services that share dependencies, and can be orchestrated and scaled together. A single stack is capable of defining and coordinating the functionality of an entire application (though very complex applications may want to use multiple stacks).</p>
<h3 id="增加visualizer服务"><a class="header-anchor" href="#增加visualizer服务">¶</a>增加visualizer服务</h3>
<ol>
<li>修改docker-compose.yml文件，在services节点下添加： <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">services:</span><br><span class="line">  visualizer:</span><br><span class="line">    image: dockersamples/visualizer:stable</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;8080:8080&quot;</span><br><span class="line">    volumes:</span><br><span class="line">      - &quot;/var/run/docker.sock:/var/run/docker.sock&quot;</span><br><span class="line">    deploy:</span><br><span class="line">      placement:</span><br><span class="line">        constraints: [node.role == manager]</span><br><span class="line">    networks:</span><br><span class="line">      - webnet</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>增加了一项visualizer服务，a volumes key, giving the visualizer access to the host’s socket file for Docker, and a placement key, ensuring that this service only ever runs on a swarm manager – never a worker. That’s because this container, built from an open source project created by Docker, displays Docker services running on a swarm in a diagram.</p>
<ol>
<li>重新部署 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 重新部署</span><br><span class="line">docker stack deploy -c docker-compose.yml getstartedlab</span><br><span class="line"># 查看应用中的Task</span><br><span class="line">docker stack ps getstartedlab</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="增加redis服务"><a class="header-anchor" href="#增加redis服务">¶</a>增加redis服务</h3>
<ol>
<li>在docker-compose.yml中增加redis服务： <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">services:</span><br><span class="line">  redis:</span><br><span class="line">    image: redis</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;6379:6379&quot;</span><br><span class="line">    volumes:</span><br><span class="line">      - &quot;/home/docker/data:/data&quot;</span><br><span class="line">    deploy:</span><br><span class="line">      placement:</span><br><span class="line">        constraints: [node.role == manager]</span><br><span class="line">    command: redis-server --appendonly yes</span><br><span class="line">    networks:</span><br><span class="line">      - webnet</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>redis always runs on the manager, so it’s always using the same filesystem.<br>
redis accesses an arbitrary directory in the host’s file system as /data inside the container, which is where Redis stores data. 会在容器的/data路径下存储数据，并在容器被重新部署后清空。<br>
The placement constraint you put on the Redis service, ensuring that it always uses the same host.想搭建redis集群怎么办？？？<br>
The volume you created that lets the container access ./data (on the host) as /data (inside the Redis container). While containers come and go, the files stored on ./data on the specified host persists, enabling continuity.上边volumes配置项指定了：容器的/data目录对应着服务器的./data目录（相对docker用户来说）</p>
<ol>
<li>创建服务器的./data目录<br>
否则会出现redis服务并没有开启 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-machine ssh myvm1 &quot;mkdir ./data&quot;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h1>App &amp; Cloud</h1>
<h2 id="在远程主机部署docker服务"><a class="header-anchor" href="#在远程主机部署docker服务">¶</a>在远程主机部署Docker服务</h2>
<ol>
<li>X我使用无驱动的方式部署没有成功过 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-machine create --driver none --url=tcp://59.110.172.126:2376 ecs-59</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>使用generic驱动<br>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-machine create --driver generic --generic-ip-address=59.110.172.126 ecs-59</span><br></pre></td></tr></table></figure></p>
<ol>
<li>
<p>创建密钥<br>
将公钥文件（xxx.pub）内容拷贝到服务器的~/.ssh/authorized_keys文件内，</p>
</li>
<li>
<p>查看</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl http://59.110.172.126:2376/info</span><br><span class="line">或</span><br><span class="line">docker -H tcp://59.110.172.126:2376 info</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>连接</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eval $(docker-machine env ecs-59)</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>查看日志</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo journalctl -fu docker.service</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h1>参考</h1>
<ol>
<li><a href="https://docs.docker.com/get-started/" target="_blank" rel="noopener">Docker - get-started</a></li>
<li><a href="https://docs.docker.com/engine/reference/run/" target="_blank" rel="noopener">Command-Line Interfaces</a></li>
<li><a href="https://docs.docker.com/engine/reference/builder/" target="_blank" rel="noopener">Dockerfile reference</a></li>
<li><a href="https://docs.docker.com/machine/get-started-cloud/#add-a-host-without-a-driver" target="_blank" rel="noopener">Use Docker Machine to provision hosts on cloud providers</a></li>
<li><a href="https://yq.aliyun.com/articles/7495?commentId=1091" target="_blank" rel="noopener">使用Docker Machine管理阿里云ECS</a></li>
<li><a href="https://docs.docker.com/develop/" target="_blank" rel="noopener">Develop with Docker</a></li>
</ol>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Docker/" rel="tag"># Docker</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/459b2cfd.html" rel="next" title="Dubbo的网络通信">
                <i class="fa fa-chevron-left"></i> Dubbo的网络通信
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2215add6.html" rel="prev" title="Dubbo服务调用过程">
                Dubbo服务调用过程 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div id="gitalk-container"></div>

  

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">tallate</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">142</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">22</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">73</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          <div class="links-of-author motion-element">
            
          </div>

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#undefined"><span class="nav-number">1.</span> <span class="nav-text">Container</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#dockerfile"><span class="nav-number">1.1.</span> <span class="nav-text">¶Dockerfile</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#示例"><span class="nav-number">1.1.1.</span> <span class="nav-text">¶示例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#设置代理服务器"><span class="nav-number">1.1.2.</span> <span class="nav-text">¶设置代理服务器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#发布dockerfile"><span class="nav-number">1.1.3.</span> <span class="nav-text">¶发布Dockerfile</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#undefined"><span class="nav-number">2.</span> <span class="nav-text">Service(Compose)</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#service"><span class="nav-number">2.1.</span> <span class="nav-text">¶Service</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#使用docker-compose编排服务"><span class="nav-number">2.1.1.</span> <span class="nav-text">¶使用Docker Compose编排服务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#task"><span class="nav-number">2.1.2.</span> <span class="nav-text">¶Task</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#scale"><span class="nav-number">2.1.3.</span> <span class="nav-text">¶scale</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#undefined"><span class="nav-number">3.</span> <span class="nav-text">Swarm(Cluster)</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#安装docker-machine"><span class="nav-number">3.1.</span> <span class="nav-text">¶安装docker-machine</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#swarm"><span class="nav-number">3.2.</span> <span class="nav-text">¶Swarm</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#manager和worker"><span class="nav-number">3.2.1.</span> <span class="nav-text">¶manager和worker</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#多种运行容器策略"><span class="nav-number">3.2.2.</span> <span class="nav-text">¶多种运行容器策略</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#初始化虚拟机"><span class="nav-number">3.2.3.</span> <span class="nav-text">¶初始化虚拟机</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#在虚拟机中执行"><span class="nav-number">3.2.4.</span> <span class="nav-text">¶在虚拟机中执行</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#初始化swarm集群"><span class="nav-number">3.2.5.</span> <span class="nav-text">¶初始化Swarm集群</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#在集群中部署app"><span class="nav-number">3.2.6.</span> <span class="nav-text">¶在集群中部署app</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#集群路由原理"><span class="nav-number">3.2.7.</span> <span class="nav-text">¶集群路由原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#终止"><span class="nav-number">3.2.8.</span> <span class="nav-text">¶终止</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#移除docker-machine-shell-variable环境变量设置"><span class="nav-number">3.2.9.</span> <span class="nav-text">¶移除docker-machine shell variable环境变量设置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#重启"><span class="nav-number">3.2.10.</span> <span class="nav-text">¶重启</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#undefined"><span class="nav-number">4.</span> <span class="nav-text">Stack(Complex Cluster)</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#stack"><span class="nav-number">4.1.</span> <span class="nav-text">¶Stack</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#增加visualizer服务"><span class="nav-number">4.1.1.</span> <span class="nav-text">¶增加visualizer服务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#增加redis服务"><span class="nav-number">4.1.2.</span> <span class="nav-text">¶增加redis服务</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#undefined"><span class="nav-number">5.</span> <span class="nav-text">App &amp; Cloud</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#在远程主机部署docker服务"><span class="nav-number">5.1.</span> <span class="nav-text">¶在远程主机部署Docker服务</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#undefined"><span class="nav-number">6.</span> <span class="nav-text">参考</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        

<div class="copyright">&copy; <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">tallate</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.3</div>








        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i> 访问人数
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i> 访问总量
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      次
    </span>
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.3"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.3"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.3"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  


  




	





  





  












  <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
  <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
   <script type="text/javascript">
        var gitalk = new Gitalk({
          clientID: '72bdd1c9479eb0679788',
          clientSecret: '62c9c0cb45aadb1478ca66cfc3c69c9623f50290',
          repo: 'tallate.github.io',
          owner: 'tallate',
          admin: ['tallate'],
          id: location.pathname,
          distractionFreeMode: 'true'
        })
        gitalk.render('gitalk-container')           
       </script>



  





  

  

  
  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

  


</body>
</html>
